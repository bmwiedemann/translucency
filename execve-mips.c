#include "base.h"
// mips specific
asmlinkage int redirecting_sys_execve(struct pt_regs regs)
{
        int error, rresult;
        char * filename;
        char * execname;
	char local0[REDIR_BUFSIZE];

        filename = getname((char *) (long)regs.regs[4]);
        error = PTR_ERR(filename);
        if (IS_ERR(filename))
                goto out;
	//printk("redir-execve %s\n", filename);
	strncpy(local0, filename, REDIR_BUFSIZE-1);
	if((rresult=redirect0(local0))>0) {
//		printk("redirected %i to %s\n", rresult, local0);
		execname=local0;
	} else execname=filename;
	error = do_execve(execname, (char **) (long)regs.regs[5],
                          (char **) (long)regs.regs[6], &regs);
        putname(filename);

out:
        return error;
}
